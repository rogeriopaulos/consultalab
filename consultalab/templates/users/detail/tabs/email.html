{% load static crispy_forms_tags i18n %}

{% if user.emailaddress_set.all %}
  <p class="text-secondary">
    <i class="fa-solid fa-circle-info"></i>
    {% if user.emailaddress_set.count == 1 %}
      O seguinte endereço de e-mail está associado a sua conta:
    {% else %}
      Os seguintes endereços de e-mail estão associados a sua conta:
    {% endif %}
  </p>
  <form action="{% url 'users:custom_email' %}"
        class="email_list"
        method="post"
        id="email-list-form">
    {% csrf_token %}
    <fieldset class="blockLabels">
      {% for emailaddress in user.emailaddress_set.all %}
        <div class="radio p-2 mb-3">
          <label for="email_radio_{{ forloop.counter }}"
                 class="{% if emailaddress.primary %}primary_email{% endif %}">
            <input id="email_radio_{{ forloop.counter }}"
                   type="radio"
                   name="email"
                   {% if emailaddress.primary or user.emailaddress_set.count == 1 %}checked="checked"{% endif %}
                   value="{{ emailaddress.email }}" />
            <span class="me-2 {% if emailaddress.primary or user.emailaddress_set.count == 1 %}fw-bold{% endif %}">
              {{ emailaddress.email }}
            </span>
            {% if emailaddress.verified %}
              <span class="badge rounded-pill text-bg-success verified">Verificado</span>
            {% else %}
              <span class="badge rounded-pill text-bg-danger unverified">Não verificado</span>
            {% endif %}
            {% if emailaddress.primary %}<span class="badge rounded-pill text-bg-primary primary">Primário</span>{% endif %}
          </label>
        </div>
      {% endfor %}
      <div class="form-group">
        <button class="secondaryAction btn btn-sm btn-primary"
                type="submit"
                name="action_primary"
                hx-post="{% url 'users:custom_email' %}"
                hx-target="#tab-content"
                hx-swap="innerHTML"
                hx-include="#email-list-form">
          <i class="fa-solid fa-dice-one"></i> Definir como Primário
        </button>
        <button class="secondaryAction btn btn-sm btn-secondary"
                type="submit"
                name="action_send"
                hx-post="{% url 'users:custom_email' %}"
                hx-target="#tab-content"
                hx-swap="innerHTML"
                hx-include="#email-list-form">
          <i class="fa-solid fa-envelope"></i> Reenviar E-mail de Verificação
        </button>
        <button class="primaryAction btn btn-sm btn-danger"
                type="submit"
                name="action_remove"
                hx-post="{% url 'users:custom_email' %}"
                hx-target="#tab-content"
                hx-swap="innerHTML"
                hx-include="#email-list-form">
          <i class="fa-solid fa-trash"></i> Remover
        </button>
      </div>
    </fieldset>
  </form>
{% else %}
  <h3>
    <i class="fa-solid fa-triangle-exclamation text-warning"></i> Atenção!
  </h3>
  <p class="text-secondary">
    Atualmente, você não tem nenhum endereço de e-mail configurado.
    <br />
    Você realmente deve adicionar um endereço de e-mail para que você possa receber notificações,
    redefinir sua senha, etc.
  </p>
{% endif %}
<hr class="border border-secondary opacity-25" aria-hidden="true" />
<h5 class="text-secondary">
  <i class="fa-solid fa-envelope-circle-check"></i> Adicionar Endereço de E-mail
</h5>
<form method="post"
      action="{% url 'users:custom_email' %}"
      class="add_email"
      id="add-email-form">
  {% csrf_token %}
  {{ email_form|crispy }}
  <button class="btn btn-outline-dark btn-sm"
          name="action_add"
          type="submit"
          hx-post="{% url 'users:custom_email' %}"
          hx-target="#tab-content"
          hx-swap="innerHTML"
          hx-include="#add-email-form">
    <i class="fa-solid fa-plus"></i> Adicionar Endereço de E-mail
  </button>
</form>
