{% extends "base.html" %}

{% load static %}

{% block title %}
  Meu Perfil - {{ object.name }}
{% endblock title %}
{% block css %}
  {{ block.super }}
  <link href="{% static 'css/tab_section.css' %}" rel="stylesheet" />
  <link href="{% static 'css/user_detail.css' %}" rel="stylesheet" />
{% endblock css %}
{% block javascript %}
  {{ block.super }}
  <script defer src="{% static 'js/user_detail.js' %}"></script>
{% endblock javascript %}
{% block content %}
  <div class="container">
    <div class="row border border-2 rounded p-3 shadow bg-light mb-4 mt-3">
      <div class="col-sm-12">
        <h5 class="mb-4">
          <i class="bi bi-person-circle"></i> {{ object.name }}
        </h5>
        <div class="tab-list">
          <nav class="nav nav-pills flex-column flex-sm-row" role="tablist">
            <a hx-get="{% url 'users:profile' %}"
               hx-target="#tab-content"
               hx-trigger="click"
               class="flex-sm-fill text-sm-center nav-link active cl-nav-link"
               data-bs-toggle="pill"
               aria-current="page"
               href="#">Perfil</a>
            <a hx-get="{% url 'users:email_tab' %}"
               hx-target="#tab-content"
               hx-trigger="click"
               class="flex-sm-fill text-sm-center nav-link cl-nav-link"
               data-bs-toggle="pill"
               href="#">E-mail</a>
            <a hx-get="{% url 'users:security_tab' %}{% if request.GET.force_password_change %}?force_password_change=true{% endif %}"
               hx-target="#tab-content"
               hx-trigger="click"
               class="flex-sm-fill text-sm-center nav-link cl-nav-link"
               data-bs-toggle="pill"
               href="#"
               id="security-tab">Seguran√ßa</a>
          </nav>
        </div>
        <div id="tabs"
             hx-get="{% url 'users:profile' %}"
             hx-trigger="load delay:100ms"
             hx-target="#tab-content"
             hx-swap="innerHTML"></div>
        <div id="tab-content" role="tabpanel" class="tab-content p-4"></div>
      </div>
    </div>
  </div>
{% endblock content %}
{% block inline_javascript %}
  {% if request.GET.force_password_change %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          const securityTab = document.getElementById('security-tab');
          if (securityTab) {
            securityTab.click();
          }
        }, 300);

        const url = new URL(window.location);
        url.searchParams.delete('force_password_change');
        window.history.replaceState({}, '', url);
      });
    </script>
  {% endif %}
{% endblock inline_javascript %}
